/****************************************************************************\
**  版    权 : 
**  文件名称 :  
**  功能描述 :  
**  作    者 :  
**  日    期 :  
**  版    本 :  V0.0.1
**  变更记录 :  V0.0.1/
                1 首次创建
\****************************************************************************/

/******************************************************************************\
                                 Includes
\******************************************************************************/
#include "sys.h"
/******************************************************************************\
                             Macro definitions
\******************************************************************************/

/******************************************************************************\
                             Typedef definitions
\******************************************************************************/

/******************************************************************************\
                             Variables definitions
\******************************************************************************/

/******************************************************************************\
                             Functions definitions
\******************************************************************************/

/**
 * @brief  执行WFI（Wait For Interrupt）指令，使CPU进入低功耗模式
 * @note   - THUMB指令集不支持内联汇编，因此使用独立汇编函数实现
 *         - WFI指令使CPU进入等待中断状态，直到有中断发生才唤醒
 *         - 用于实现低功耗模式，降低系统功耗
 * @warning 执行此函数后，CPU将进入低功耗状态，只有中断才能唤醒
 */
__asm void WFI_SET(void)
{
    WFI;  /* Wait For Interrupt - 等待中断指令 */
}

/**
 * @brief  关闭所有可屏蔽中断
 * @note   - 使用CPSID I指令禁用中断
 *         - 不包含fault异常和NMI（不可屏蔽中断）
 *         - 用于临界区保护，防止中断打断关键代码执行
 * @warning 调用此函数后必须调用INTX_ENABLE()恢复中断，否则系统无法响应中断
 * @see    INTX_ENABLE()
 */
__asm void INTX_DISABLE(void)
{
    CPSID   I  /* Change Processor State, Interrupt Disable - 禁用中断 */
    BX      LR /* Branch and Exchange - 返回调用者 */
}

/**
 * @brief  开启所有可屏蔽中断
 * @note   - 使用CPSIE I指令使能中断
 *         - 与INTX_DISABLE()配对使用，恢复中断使能
 *         - 用于退出临界区保护
 * @warning 确保与INTX_DISABLE()成对调用，避免中断状态不匹配
 * @see    INTX_DISABLE()
 */
__asm void INTX_ENABLE(void)
{
    CPSIE   I  /* Change Processor State, Interrupt Enable - 使能中断 */
    BX      LR /* Branch and Exchange - 返回调用者 */
}

/**
 * @brief  设置主堆栈指针（MSP）地址
 * @param  addr 堆栈指针的新地址值
 * @note   - 将参数addr（通过r0寄存器传递）设置到MSP寄存器
 *         - 用于动态修改堆栈指针，常用于任务切换或系统初始化
 *         - MSP是ARM Cortex-M内核的主堆栈指针寄存器
 * @warning 修改堆栈指针可能导致程序异常，请确保新地址有效且对齐
 */
__asm void MSR_MSP(uint32_t addr)
{
    MSR MSP, r0  /* Move to Special Register - 将r0的值写入MSP寄存器 */
    BX r14        /* Branch and Exchange - 返回调用者（r14 = LR） */
}








